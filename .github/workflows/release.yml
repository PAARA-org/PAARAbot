name: üì¶ Automated Cross-Platform Release

on:
  # Trigger this workflow only when a new tag is pushed (e.g., v1.0.0)
  push:
    tags:
      - 'v*'

permissions:
  # Needed for the softprops/action-gh-release action to create the release
  contents: write

jobs:
  build-binaries:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        # Define the target OS, Architecture, and ARM version
        include:
          # --- Linux Targets ---
          - GOOS: linux
            GOARCH: amd64
            GOARM: ""
          - GOOS: linux
            GOARCH: arm
            GOARM: "6"
          - GOOS: linux
            GOARCH: arm
            GOARM: "7"
            
          # --- Windows Target ---
          - GOOS: windows
            GOARCH: amd64
            GOARM: ""

          # --- macOS Target (Darwin) ---
          - GOOS: darwin
            GOARCH: amd64
            GOARM: ""


    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.22'

      - name: ‚öôÔ∏è Make build.sh executable
        run: chmod +x build.sh

      - name: üèóÔ∏è Build Binary (${{ matrix.GOOS }}/${{ matrix.GOARCH }}${{ matrix.GOARM }})
        env:
          GOOS: ${{ matrix.GOOS }}
          GOARCH: ${{ matrix.GOARCH }}
          GOARM: ${{ matrix.GOARM }} # Used only for GOARCH=arm
        run: |
          # 1. Determine the base binary name
          if [ "${{ matrix.GOARCH }}" == "arm" ]; then
            # Specific name for ARM builds (e.g., PAARAbot-linux-armv6)
            BIN_NAME="PAARAbot-${{ matrix.GOOS }}-${{ matrix.GOARCH }}v${{ matrix.GOARM }}"
          else
            # Standard name (e.g., PAARAbot-windows-amd64)
            BIN_NAME="PAARAbot-${{ matrix.GOOS }}-${{ matrix.GOARCH }}"
          fi

          # 2. Execute the build script. Assumes build.sh outputs to PAARAbot
          ./build.sh

          # 3. Rename and add extension for Windows
          if [ "${{ matrix.GOOS }}" == "windows" ]; then
            # Assuming build.sh creates 'PAARAbot.exe' for Windows
            mv PAARAbot.exe "${BIN_NAME}.exe" 
          else
            # Assuming build.sh creates 'PAARAbot' for Linux/macOS
            mv PAARAbot "${BIN_NAME}"
          fi

      - name: ‚¨ÜÔ∏è Upload Binary as Release Asset
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: PAARAbot* # Matches all created binaries
          draft: false
          prerelease: false
